---
- name: Install Alacritty
  hosts: localhost
  tasks:

    - name: Install dependencies
      apt:
        name:
          - cmake
          - pkg-config
          - libfreetype6-dev
          - libfontconfig1-dev
          - libxcb-xfixes0-dev
          - libxkbcommon-dev
          - python3
        state: present
        update_cache: yes

    - name: Clone the Alacritty repository
      git:
        repo: 'https://github.com/alacritty/alacritty.git'
        dest: '/opt/alacritty'
        update: yes

    - name: Install Rust compiler with rustup
      shell: |
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
        source $HOME/.cargo/env
        rustup override set stable
        rustup update stable
      args:
        executable: /bin/bash

    - name: Build Alacritty
      shell: |
        source $HOME/.cargo/env
        cd /opt/alacritty
        cargo build --release
      args:
        executable: /bin/bash

    - name: Install terminfo for Alacritty
      shell: |
        cd /opt/alacritty
        sudo tic -xe alacritty,alacritty-direct extra/alacritty.info
      args:
        executable: /bin/bash

    - name: Install Alacritty binary
      copy:
        src: /opt/alacritty/target/release/alacritty
        dest: /usr/local/bin/
        mode: '0755'

    - name: Install Alacritty logo
      copy:
        src: /opt/alacritty/extra/logo/alacritty-term.svg
        dest: /usr/share/pixmaps/Alacritty.svg

    - name: Install Alacritty desktop entry
      shell: |
        sudo desktop-file-install /opt/alacritty/extra/linux/Alacritty.desktop
        sudo update-desktop-database
      args:
        executable: /bin/bash

    - name: Install bash completions for Alacritty
      shell: |
        mkdir -p ~/.bash_completion
        cp /opt/alacritty/extra/completions/alacritty.bash ~/.bash_completion/alacritty
        echo "source ~/.bash_completion/alacritty" >> ~/.bashrc
      args:
        executable: /bin/bash
